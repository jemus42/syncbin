#! /usr/bin/env bash
# fulltex
# Usage: fulltex -f filename.tex [-c] [-p] filename (without extension)
 
while getopts ":f::c;p:" opt; do
  case $opt in
    f) 
       FILE=$(echo $OPTARG | sed -e s/.tex//g)
       echo "1) Processing $FILE.tex with pdflatex (x2)…";
       echo -e '                     (0%)\r\c'
       pdflatex -synctex=1 -interaction=nonstopmode $FILE.tex > .texlog;
       echo -e '##########           (50%)\r\c'
       pdflatex -synctex=1 -interaction=nonstopmode $FILE.tex >> .texlog; 
       echo -e '#################### (100%)\r\c'
       echo -e "\nDone."

       echo "2) Starting bibtex processing… (bibtex - pdflatex - bibtex)";
       echo -e '                     (0%)\r\c'
       bibtex $FILE.aux >> .texlog;
       echo -e '#######              (33%)\r\c'
       pdflatex -synctex=1 -interaction=nonstopmode $FILE.tex >> .texlog;
       echo -e '##############       (66%)\r\c'
       bibtex $FILE.aux >> .texlog;
       echo -e '#################### (100%)\r\c'
       echo -e "\nDone."

       echo "3) Starting second processing with pdflatex (x2)…";
       echo -e '                     (0%)\r\c'
       pdflatex -synctex=1 -interaction=nonstopmode $FILE.tex >> .texlog;
       echo -e '##########           (50%)\r\c'
       pdflatex -synctex=1 -interaction=nonstopmode $FILE.tex >> .texlog;
       echo -e '#################### (100%)\r\c'
       echo -e "\nDone processing."
       ;;
    c) 
       echo "Removing garbage… (.aux, .synctex.gz, .out, …)";
       rm *.aux *.synctex.gz *.out *.blg *.toc *.bbl *.log;
       ;;
    p) 
       echo "Pushing to filedump";
       scp $FILE.pdf mercy:"~/dumpdir/Hausarbeiten/$OPTARG" > /dev/null;
       echo "http://dump.jemu.name/Hausarbeiten/$OPTARG";
       ;;
    \?)
      echo "Invalid option: -$OPTARG" >&2
      ;;
  esac
done
