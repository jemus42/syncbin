#!/usr/bin/env Rscript

args <- commandArgs(trailingOnly = TRUE)

# Try to read from stdin using non-blocking mode
con <- file('stdin', open = 'r', blocking = FALSE)
stdin_lines <- readLines(con)
close(con)

# Filter out empty lines and whitespace
stdin_lines <- stdin_lines[nzchar(trimws(stdin_lines))]

if (length(stdin_lines) > 0) {
  # Data was piped in via stdin
  cli::cli_inform("Installing packages from stdin: {stdin_lines}")
  pak::pak(stdin_lines)
} else if (length(args) == 0) {
  cli::cli_inform("Running pak::pak()")
  pak::pak()
} else if (length(args) == 1 && args[1] == ".") {
  cli::cli_inform("Running pak::local_install(upgrade = FALSE)")
  pak::local_install(upgrade = FALSE)
} else {
  cli::cli_inform("Installing packages: {args}")
  pak::pak(args)
}